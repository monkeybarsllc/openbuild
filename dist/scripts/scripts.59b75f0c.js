"use strict";angular.module("openbuildApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","mgcrea.ngStrap","chart.js","firebase","uiGmapgoogle-maps"]).config(["uiGmapGoogleMapApiProvider",function(a){a.configure({key:"AIzaSyAZIkwd2AxmBp6qe2iVQnuv3gP4-NiYNVI",v:"3.18",libraries:"places, circle"})}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl"}).when("/events/new",{templateUrl:"views/newevent.html",controller:"NeweventCtrl"}).when("/volunteer",{templateUrl:"views/volunteer.html",controller:"VolunteerCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("openbuildApp").controller("MainCtrl",["$scope","eventService",function(a,b){a.projectLabels=["Hardware","Hardcore CS","Service"],a.projectData=[2,3,5],a.projectOptions={animation:!1,showTooltips:!1},a.attendeeLabels=["Developer","Designer","Maker","Biz Dev","Strategist"],a.attendeeData=[22,4,1,4,2],a.attendeeOptions={animation:!1,showTooltips:!1},a.events=b.getEvents(),a.selectedEvent={selected:!1},a.selectedIndex=null,a.selectEvent=function(b,c){a.selectedEvent.selected=!1,a.selectedEvent=b,a.selectedEvent.selected=!0,a.selectedEvent.readonly=!0,a.selectedIndex=c}}]),angular.module("openbuildApp").factory("authService",["$firebaseAuth","$q","userService",function(a,b,c){function d(a){var d=b.defer();return g.child("userRoles").child(a).once("value",function(b){null===b.val()?d.reject():c.setUser(a).then(function(){d.resolve(b.val())})}),d.promise}function e(a,c){var d=b.defer();return f(a,"attendee").then(function(){g.child("userProfiles").child(a).set(c,function(){d.resolve()})}),d.promise}function f(a,c){var d=b.defer();return g.child("userRoles").child(a).set(c,function(){d.resolve()}),d.promise}var g=new Firebase("https://openbuild.firebaseio.com/"),h=a(g),i=!1,j=null;h.$onAuth(function(a){a?d(a.uid).then(function(a){i=!0,j=a}):i=!1});var k={};return k.register=function(a,c,f){var g=b.defer();return h.$createUser({email:a,password:c}).then(function(){h.$authWithPassword({email:a,password:c}).then(function(a){d(a.uid).then(function(){g.reject()})["catch"](function(){e(a.uid,f).then(function(){g.resolve()})})})}),g.promise},k.isLoggedIn=function(){return i},k.login=function(a,c){var e=b.defer();return h.$authWithPassword({email:a,password:c}).then(function(a){d(a.uid).then(function(){e.resolve()})["catch"](function(){e.reject()})})["catch"](function(a){console.error("Authentication failed:",a)}),e.promise},k.logout=function(){h.$unauth()},k.isAdmin=function(){return"admin"==j},k}]),angular.module("openbuildApp").controller("LoginCtrl",["$location","$scope","authService",function(a,b,c){b.$watch(c.isLoggedIn,function(){c.isLoggedIn()&&a.path("/dashboard")}),b.login=function(d){d&&c.login(b.email,b.password).then(function(){a.path("/dashboard")})["catch"](function(){a.path("/register")})}}]),angular.module("openbuildApp").controller("NavCtrl",["$scope","authService","userService",function(a,b,c){a.$watch(b.isLoggedIn,function(){a.loggedIn=b.isLoggedIn()}),a.$watch(c.getUser,function(){a.user=c.getUser()}),a.logout=function(){b.logout()},a.userDropdown=[{text:"Profile",href:"#/profile"},{text:"Logout",click:"logout()"}]}]),angular.module("openbuildApp").controller("DashboardCtrl",["$location","$scope","authService","userService",function(a,b,c,d){b.$watch(c.isLoggedIn,function(){c.isLoggedIn()?c.isAdmin&&a.path("/admin"):a.path("/login")}),b.$watch(d.getUser,function(){b.user=d.getUser()})}]),angular.module("openbuildApp").controller("RegisterCtrl",["$location","$scope","authService",function(a,b,c){b.$watch(c.isLoggedIn,function(){c.isLoggedIn()&&a.path("/dashboard")}),b.register=function(d){if(d){var e={name:b.userName,email:b.email};c.register(b.email,b.password,e).then(function(){a.path("/dashboard")})["catch"](function(){a.path("/login")})}}}]),angular.module("openbuildApp").factory("userService",["$firebase","$q",function(a,b){var c,d=new Firebase("https://openbuild.firebaseio.com/userProfiles"),e={};return e.setUser=function(e){var f=b.defer();return c=a(d.child(e)).$asObject(),c.$loaded().then(function(){f.resolve()}),f.promise},e.getUser=function(){return c},e.getUserKey=function(){return c.$id},e.updateUser=function(){var a=b.defer();return c.$save().then(function(){a.resolve({title:"Updated!",type:"success"})})["catch"](function(b){a.reject({title:"Update failed! ",content:b,type:"danger"})}),a.promise},e}]),angular.module("openbuildApp").controller("AdminCtrl",["$location","$filter","$scope","authService","eventService",function(a,b,c,d,e){c.$watch(d.isLoggedIn,function(){d.isLoggedIn()||a.path("/login"),d.isAdmin||a.path("/dashboard")}),c.events=e.getEvents(),c.selectedEvent={selected:!1},c.selectedIndex=null,c.addDateToSchedule=function(){var a=null;c.selectedEvent.schedule?a=Object.keys(c.selectedEvent.schedule).length:(c.selectedEvent.schedule={},a=0),c.selectedEvent.schedule[a]={date:c.newDate.toJSON()},c.newDate=null},c.addScheduleItem=function(a,b){var c=null;a.items?c=Object.keys(a.items).length:(a.items={},c=0),a.items[c]={time:b.time.toJSON(),description:b.description},b=null},c.addPartnerToEvent=function(a){var b=null;c.selectedEvent.partners?b=Object.keys(c.selectedEvent.partners).length:(c.selectedEvent.partners={},b=0),c.selectedEvent.partners[b]={name:a.name,imageLink:a.imageLink},a=null},c.editEvent=function(){c.selectedEvent.readonly=0==c.selectedEvent.readonly},c.selectEvent=function(a,b){c.selectedEvent.selected=!1,c.selectedEvent=a,c.selectedEvent.selected=!0,c.selectedEvent.readonly=!0,c.selectedIndex=b},c.updateEvent=function(a){a&&e.updateEvent(c.selectedIndex).then(function(){c.selectedEvent.readonly=!0})},c.updateScheduleItem=function(a){a.time=a.time.toJSON(),a.edit=!a.edit}}]),angular.module("openbuildApp").controller("NeweventCtrl",["$location","$scope","uiGmapGoogleMapApi","authService","eventService",function(a,b,c,d,e){b.$watch(d.isLoggedIn,function(){d.isLoggedIn()||a.path("/login"),d.isAdmin||a.path("/dashboard")});var f={places_changed:function(a){var c=a.getPlaces();b.map={center:{latitude:c[0].geometry.location.lat(),longitude:c[0].geometry.location.lng()},zoom:15},b.marker={id:0,coords:{latitude:c[0].geometry.location.lat(),longitude:c[0].geometry.location.lng()},options:{draggable:!1}},b.event.venue={googleId:c[0].id,placeId:c[0].place_id,name:c[0].name,address:c[0].formatted_address,htmlAddress:c[0].adr_address,coords:{latitude:c[0].geometry.location.lat(),longitude:c[0].geometry.location.lng()}}}};b.map={center:{latitude:40.1451,longitude:-99.668},zoom:3},b.searchbox={template:"searchbox.tpl.html",events:f,options:{}},b.marker={id:0},b.event={},c.then(function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){var c=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),d=new google.maps.Circle({center:c,radius:a.coords.accuracy});b.$apply(function(){b.searchbox.options=d.getBounds(),b.map={center:{latitude:a.coords.latitude,longitude:a.coords.longitude},zoom:10}})})}),b.createEvent=function(c){c&&e.addEvent(b.event).then(function(){a.path("/admin")})}}]),angular.module("openbuildApp").factory("eventService",["$firebase","$q",function(a,b){function c(a){return a.startDate=a.startDate.toJSON(),a.endDate=a.endDate.toJSON(),a}var d=new Firebase("https://openbuild.firebaseio.com/events"),e=a(d).$asArray(),f={};return f.getEvents=function(){return e},f.addEvent=function(a){var d=c(a),f=b.defer();return e.$add(d).then(function(){f.resolve()})["catch"](function(){f.reject()}),f.promise},f.updateEvent=function(a){var c=b.defer();return e.$save(a).then(function(){c.resolve()}),c.promise},f}]),angular.module("openbuildApp").controller("VolunteerCtrl",function(){});